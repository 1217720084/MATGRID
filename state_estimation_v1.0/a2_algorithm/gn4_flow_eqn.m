 function [Pij, Qij] = gn4_flow_eqn(V, teta, p, q)


 
%--------------------------Active Power Flow-------------------------------
 Vi = diag(V(p(:,1)));                                                         
 Vj = V(p(:,2));                                                                

 T = p(:,5) .* (cos(teta(p(:,1)) - teta(p(:,2)))) + ...                                        
     p(:,6) .* (sin(teta(p(:,1)) - teta(p(:,2))));                                        

 Pij = Vi^2 * (p(:,5) + p(:,7)) - diag(T) * Vi * Vj;
%--------------------------------------------------------------------------


%-------------------------Reactive Power Flow------------------------------
 Vi = diag(V(q(:,1)));                                                          
 Vj = V(q(:,2));  
 
 T = q(:,5) .* (sin(teta(q(:,1)) - teta(q(:,2)))) - ...                                      
     q(:,6) .* (cos(teta(q(:,1)) - teta(q(:,2)))); 

 Qij = - Vi^2 * (q(:,6) + q(:,7)) - diag(T) * Vi * Vj;
%--------------------------------------------------------------------------